#!/bin/bash

# Colors
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

sync_repo() {
    local repo_path="$1"
    local repo_name="$2"
    
    if [ ! -d "$repo_path/.git" ]; then
        return
    fi
    
    cd "$repo_path" || return
    
    # Check for local changes
    if [[ -n $(git status -s) ]]; then
        echo -e "${YELLOW}ðŸ“ Changes detected in $repo_name${NC}"
        git add .
        git commit -m "Auto-update: $(date +'%Y-%m-%d %H:%M')" || true
        echo -e "${GREEN}âœ“ Committed changes in $repo_name${NC}"
    fi
    
    # Check for remote updates
    git fetch origin &>/dev/null
    LOCAL=$(git rev-parse @)
    REMOTE=$(git rev-parse @{u})
    
    if [ "$LOCAL" != "$REMOTE" ]; then
        echo -e "${YELLOW}ðŸ“¥ Updates available for $repo_name${NC}"
        read -p "Pull updates? (y/n) " -n 1 -r
        echo
        if [[ $REPLY =~ ^[Yy]$ ]]; then
            git pull --rebase || git pull
            echo -e "${GREEN}âœ“ Updated $repo_name${NC}"
        fi
    fi
    
    # Push if we have unpushed commits
    UNPUSHED=$(git log @{u}.. --oneline 2>/dev/null)
    if [[ -n "$UNPUSHED" ]]; then
        echo -e "${YELLOW}ðŸ“¤ Pushing $repo_name...${NC}"
        git push
        echo -e "${GREEN}âœ“ Pushed $repo_name${NC}"
    fi
}

echo "ðŸ”„ Syncing configuration repos..."
echo ""

sync_repo "$HOME/.config/nvim" "Neovim"
sync_repo "$HOME/.iterm2-profiles" "iTerm2 Profiles"

echo ""
echo "âœ… Sync complete!"
